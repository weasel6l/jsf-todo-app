---
name: git-commit
description: Git コミット運用ルール。コミット粒度・Conventional Commits メッセージ規約・コミット前チェックリスト・禁止事項を含む
---

## 1. コミットの基本方針

- **1 コミット = 1 つの論理的な変更単位** とする
- コミットメッセージを読むだけで「何を・なぜ」変更したかが理解できること
- 動作しない中途半端な状態をコミットしない
- 後から **cherry-pick / revert が安全に行える粒度** を維持する

---

## 2. コミット粒度の基準

### 機能実装

レイヤーごとに **独立したコミット** とする。1 コミットに複数レイヤーを混在させてはならない。

| 対象 | コミット単位 |
|---|---|
| Repository クラスの追加 | エンティティ単位（1 Repository + テスト = 1 コミット） |
| Service クラスの追加 | ビジネスロジック単位（1 Service + テスト = 1 コミット） |
| Resource クラスの追加 | リソース単位（1 Resource + テスト = 1 コミット） |
| DTO クラスの追加 | 画面・操作単位（関連 DTO 群 = 1 コミット） |

> **NG 例**: Resource・Service・Repository をまとめて 1 コミット
> **OK 例**: Repository → Service → Resource の順に 3 コミット

### バグ修正

- **バグ 1 件 = コミット 1 件**
- 修正箇所が複数クラスにまたがる場合でも、同一バグの修正であれば 1 コミットにまとめる
- テストコードの修正は同一コミットに含める

### リファクタリング

- **機能変更を伴わない修正は必ず独立したコミットにする**（実装コミットと混在させない）
- リネーム・パッケージ移動・メソッド抽出などは操作単位でコミットを分割する

### テスト

- **本体コードと同一コミットに含めるケース**
  - 新規実装・バグ修正に対応するテスト
- **独立させるケース**
  - 既存コードに対するテスト追加のみ
  - テストのリファクタリングのみ

### 設定ファイル・インフラ変更

| ファイル | コミット単位 |
|---|---|
| `pom.xml` への依存追加 | 依存ライブラリの追加目的単位で 1 コミット |
| `microprofile-config.properties` | 機能単位で 1 コミット（実装コミットと分けてよい） |
| `beans.xml` / `META-INF` | 変更目的単位で 1 コミット |

### フォーマット・静的解析対応

- インデント修正や Checkstyle 対応は **ロジック変更とは必ず分離する**
- 差分が機械的であること

---

## 3. コミットメッセージ規約

[Conventional Commits](https://www.conventionalcommits.org/) に準拠する。

```
<type>(<scope>): <subject>
```

### type 一覧

| type | 用途 |
|---|---|
| `feat` | 新機能 |
| `fix` | バグ修正 |
| `refactor` | 動作を変えないコード改善 |
| `test` | テストの追加・修正 |
| `docs` | ドキュメント・Javadoc |
| `chore` | ビルド設定・依存関係・雑務 |
| `style` | フォーマット変更（機能に影響なし） |

### scope の例

`resource`, `service`, `repository`, `dto`, `config`, `entity`

### コミットメッセージ例

```
feat(repository): TodoRepository を TDD で実装
feat(service): TodoListService を TDD で実装
feat(resource): TodoListResource を TDD で実装
feat(dto): TodoAddRequest / TodoAddResponse DTO を追加
fix(service): 完了済み Todo の削除時に例外が発生する問題を修正
refactor(service): TodoListService のバリデーションロジックを抽出
chore(pom): Helidon MP 2.6.11 に依存を更新
test(service): TodoDetailService の異常系テストを追加
```

---

## 4. `git add` の方針

- `git add -A` や `git add .` は**原則使用しない**
- `git add <ファイルパス>` で対象ファイルを明示的に指定する
- コミット前に必ず `git status` で差分内容を確認する

---

## 5. コミット前チェックリスト

- [ ] このコミットは 1 つの目的のみを持っているか
- [ ] コミットメッセージの type と scope は適切か
- [ ] 関係のないファイルが含まれていないか（`git diff --staged` で確認）
- [ ] デバッグ用のコード・不要なコメントが残っていないか
- [ ] テストがある場合、同一コミットに含まれているか（または意図的に分けているか）

## 5-2. 作業完了時チェックリスト

- [ ] 完了報告前にローカルコミットを最低 1 件実行している
- [ ] コミット後に `git status` を確認し、意図しない差分が残っていない

---

## 6. 禁止事項（アンチパターン）

| アンチパターン | 理由 |
|---|---|
| 全ファイルをまとめて 1 コミット | リバートの範囲が広がり追跡不可 |
| `fix: いろいろ修正` のような曖昧なメッセージ | 変更内容が不明、レビュー・追跡不可 |
| テストなしで実装をコミット | 品質保証が不十分 |
| フォーマット修正と機能修正を混在 | 差分の視認性が著しく低下する |
| `pom.xml` の変更と実装を同一コミット | 依存関係変更の意図が埋もれる |
| WIP コミットをそのまま残す | 整理してからコミットすること |
